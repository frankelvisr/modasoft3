<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ERP simple - Administraci√≥n</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="admin.css">
    <script>
    function switchTab(tab) {
        // Ocultar todos los paneles
        const panels = ['dashboardPanel', 'inventarioPanel', 'comprasPanel', 'ventasPanel', 'clientesPanel', 
                       'catalogoPanel', 'promocionesPanel', 'contabilidadPanel', 'cuentas_pagarPanel', 
                       'cajaPanel', 'conciliacionPanel', 'reportesPanel', 'reporte-comprasPanel', 'reporte-ventasPanel', 
                       'reporte-clientesPanel', 'reporte-utilidadPanel'];
        const sidebarLinks = document.querySelectorAll('.sidebar-menu-link');
        
        panels.forEach(panelId => {
            const panel = document.getElementById(panelId);
            if (panel) panel.style.display = 'none';
        });
        
        sidebarLinks.forEach(link => link.classList.remove('active'));
        
        // Mostrar panel seleccionado
        const panelMap = {
            'dashboard': ['dashboardPanel', 'dashboard'],
            'inventario': ['inventarioPanel', 'inventario'],
            'compras': ['comprasPanel', 'compras'],
            'ventas': ['ventasPanel', 'ventas'],
            'clientes': ['clientesPanel', 'clientes'],
            'catalogo': ['catalogoPanel', 'catalogo'],
            'promociones': ['promocionesPanel', 'promociones'],
            'contabilidad': ['contabilidadPanel', 'contabilidad'],
            'cuentas_pagar': ['cuentas_pagarPanel', 'cuentas_pagar'],
            'caja': ['cajaPanel', 'caja'],
            'conciliacion': ['conciliacionPanel', 'conciliacion'],
            'reportes': ['reportesPanel', 'reportes'],
            'reporte-compras': ['reporte-comprasPanel', 'reporte-compras'],
            'reporte-ventas': ['reporte-ventasPanel', 'reporte-ventas'],
            'reporte-clientes': ['reporte-clientesPanel', 'reporte-clientes'],
            'reporte-utilidad': ['reporte-utilidadPanel', 'reporte-utilidad']
        };
        
        if (panelMap[tab]) {
            const [panelId, linkTab] = panelMap[tab];
            const panelEl = document.getElementById(panelId);
            if (panelEl) {
                panelEl.style.display = 'flex';
                panelEl.style.flexDirection = 'column';
            }
            
            // Activar link del sidebar
            sidebarLinks.forEach(link => {
                if (link.getAttribute('onclick') && link.getAttribute('onclick').includes(linkTab)) {
                    link.classList.add('active');
                }
            });
            
            // Cargar datos del dashboard si se selecciona
            if (tab === 'dashboard') {
                cargarDashboardData();
            }
            // Cargar contabilidad si se selecciona
            if (tab === 'contabilidad') {
                setTimeout(() => {
                    if (typeof cargarIngresos === 'function') cargarIngresos();
                }, 100);
            }
            // Cargar cuentas por pagar
            if (tab === 'cuentas_pagar') {
                setTimeout(() => {
                    if (typeof cargarCuentasPagar === 'function') cargarCuentasPagar();
                }, 100);
            }
            // Cargar control de caja
            if (tab === 'caja') {
                setTimeout(() => {
                    if (typeof cargarMovimientosCaja === 'function') cargarMovimientosCaja();
                }, 100);
            }
            // Cargar conciliaci√≥n
            if (tab === 'conciliacion') {
                setTimeout(() => {
                    if (typeof cargarConciliaciones === 'function') cargarConciliaciones();
                }, 100);
            }
            // Cargar reportes independientes
            if (tab === 'reporte-compras') {
                setTimeout(() => {
                    if (typeof renderReporteCompras === 'function') renderReporteCompras();
                }, 100);
            }
            if (tab === 'reporte-ventas') {
                setTimeout(() => {
                    if (typeof cargarVentasAdmin === 'function') cargarVentasAdmin();
                }, 100);
            }
            if (tab === 'reporte-clientes') {
                setTimeout(() => {
                    if (typeof cargarClientes === 'function') cargarClientes();
                }, 100);
            }
            if (tab === 'reporte-utilidad') {
                setTimeout(() => {
                    if (typeof cargarReporteUtilidad === 'function') cargarReporteUtilidad();
                }, 100);
            }
        }
    }
    function switchCatalogTab(tab) {
        // Oculta todas las secciones del submen√∫ de Cat√°logos
        var sections = document.querySelectorAll('.catalog-section');
        sections.forEach(function(s){ s.style.display = 'none'; });
        // Remueve active de botones
        var tabs = document.querySelectorAll('.catalog-subnav button');
        tabs.forEach(function(b){ b.classList.remove('active'); });
        // Muestra la solicitada
        if (tab === 'categorias') {
            document.getElementById('catalog-categorias').style.display = 'block';
            document.getElementById('cat-tab-categorias').classList.add('active');
        }
        if (tab === 'tallas') {
            document.getElementById('catalog-tallas').style.display = 'block';
            document.getElementById('cat-tab-tallas').classList.add('active');
        }
        if (tab === 'proveedores') {
            document.getElementById('catalog-proveedores').style.display = 'block';
            document.getElementById('cat-tab-proveedores').classList.add('active');
        }
    }
    
    // Funci√≥n para toggle del submen√∫ de reportes
    function toggleReportesSubmenu() {
        const submenu = document.getElementById('reportesSubmenu');
        const arrow = document.querySelector('.has-submenu .submenu-arrow');
        if (submenu) {
            const isVisible = submenu.style.display !== 'none';
            submenu.style.display = isVisible ? 'none' : 'block';
            if (arrow) {
                arrow.textContent = isVisible ? '‚ñº' : '‚ñ≤';
            }
        }
    }
    
    // Funci√≥n para cambiar entre pesta√±as de reportes
    function switchReporteTab(tab) {
        // Ocultar todos los reportes
        const reporteSections = document.querySelectorAll('.reporte-section');
        reporteSections.forEach(section => section.style.display = 'none');
        
        // Remover active de todos los botones
        const reporteTabs = document.querySelectorAll('.reporte-tab');
        reporteTabs.forEach(btn => btn.classList.remove('active'));
        
        // Mostrar el reporte seleccionado
        const targetSection = document.getElementById(`reporte-${tab}`);
        const targetTab = document.getElementById(`tab-${tab}`);
        
        if (targetSection) {
            targetSection.style.display = 'block';
        }
        if (targetTab) {
            targetTab.classList.add('active');
        }
        
        // Cargar datos seg√∫n el tipo de reporte
        setTimeout(() => {
            switch(tab) {
                case 'utilidad':
                    if (typeof cargarReporteUtilidad === 'function') cargarReporteUtilidad();
                    break;
                case 'inventario':
                    if (typeof renderReporteInventario === 'function') renderReporteInventario();
                    break;
                case 'compras':
                    if (typeof renderReporteCompras === 'function') renderReporteCompras();
                    break;
                case 'ventas':
                    if (typeof cargarVentasAdmin === 'function') cargarVentasAdmin();
                    break;
                case 'clientes':
                    if (typeof cargarClientes === 'function') cargarClientes();
                    break;
                case 'temporada':
                    if (typeof fetchVentasTemporada === 'function') fetchVentasTemporada('actual');
                    break;
                case 'rotacion':
                    if (typeof cargarRotacionInventario === 'function') cargarRotacionInventario();
                    break;
            }
        }, 100);
    }
    // Funciones para manejar modales
    function mostrarModal(id) {
        document.getElementById(id).style.display = 'flex';
    }
    
    function cerrarModal(id) {
        document.getElementById(id).style.display = 'none';
    }

    // Funciones para manejar eliminaci√≥n
    async function confirmarEliminacion() {
        try {
            const id = document.getElementById('eliminarId').value;
            const tipo = document.getElementById('eliminarTipo').value;
            
            // Si es producto, usar endpoint espec√≠fico de admin
            if (tipo === 'productos' || tipo === 'admin/productos') {
                const deleteRes = await fetch(`/api/admin/productos/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!deleteRes.ok) {
                    const errorData = await deleteRes.json().catch(() => ({}));
                    throw new Error(errorData.message || 'Error al eliminar el producto');
                }
                
                const deleteData = await deleteRes.json();
                if (!deleteData.ok && !deleteData.success) {
                    throw new Error(deleteData.message || 'Error al eliminar el producto');
                }
                
                // Recargar lista de productos
                if (typeof cargarProductos === 'function') {
                    cargarProductos();
                } else if (typeof window.cargarProductos === 'function') {
                    window.cargarProductos();
                }
                
                alert('‚úÖ Producto eliminado correctamente');
                cerrarModal('modalConfirmarEliminar');
                return;
            }
            
            // Para categorias, tallas y proveedores: primero verificar si el elemento est√° siendo utilizado
            const validacionRes = await fetch('/api/' + tipo + '/validar-eliminacion/' + id);
            if (!validacionRes.ok) {
                throw new Error('Error al validar la eliminaci√≥n');
            }
            const validacionData = await validacionRes.json();
            
            if (!validacionData.puedeEliminar) {
                throw new Error(validacionData.message || 'No se puede eliminar porque est√° siendo utilizado por uno o m√°s productos.');
            }
            
            // Si no est√° siendo utilizado, proceder con la eliminaci√≥n
            const deleteRes = await fetch('/api/' + tipo + '/' + id, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            
            if (!deleteRes.ok) {
                throw new Error('Error al eliminar el elemento');
            }
            
            const deleteData = await deleteRes.json();
            if (!deleteData.success) {
                throw new Error(deleteData.message || 'Error al eliminar el elemento');
            }
            
            // Si todo sali√≥ bien
            if (tipo === 'categorias') {
                cargarCategorias();
            } else if (tipo === 'tallas') {
                cargarTallas();
            } else if (tipo === 'proveedores') {
                cargarProveedores();
            }
            alert('‚úÖ Elemento eliminado correctamente');
            cerrarModal('modalConfirmarEliminar');
        } catch (error) {
            console.error('Error:', error);
            alert('‚ùå ' + (error.message || 'Error al procesar la solicitud'));
            cerrarModal('modalConfirmarEliminar');
        }
    }

    function mostrarConfirmacion(id, tipo, nombre) {
        document.getElementById('eliminarId').value = id;
        document.getElementById('eliminarTipo').value = tipo;
        let mensaje = '';
        if (tipo === 'productos' || tipo === 'admin/productos') {
            mensaje = '¬øEst√° seguro de que desea eliminar el producto "' + nombre + '"?\n\n‚ö†Ô∏è Esta acci√≥n eliminar√° el producto y su inventario. No se puede eliminar si tiene ventas registradas.';
        } else if (tipo === 'categorias') {
            mensaje = '¬øEst√° seguro de que desea eliminar la categor√≠a "' + nombre + '"?';
        } else if (tipo === 'tallas') {
            mensaje = '¬øEst√° seguro de que desea eliminar la talla "' + nombre + '"?';
        } else if (tipo === 'proveedores') {
            mensaje = '¬øEst√° seguro de que desea eliminar el proveedor "' + nombre + '"?';
        } else {
            mensaje = '¬øEst√° seguro de que desea eliminar "' + nombre + '"?';
        }
        document.getElementById('mensajeConfirmacion').textContent = mensaje;
        mostrarModal('modalConfirmarEliminar');
    }

    function cerrarModalConfirmar() {
        cerrarModal('modalConfirmarEliminar');
    }

    // Funciones para editar elementos
    function editarCategoria(id, nombre) {
        document.getElementById('editCatId').value = id;
        document.getElementById('editCatNombre').value = nombre;
        mostrarModal('modalEditarCategoria');
    }

    function editarTalla(id, data) {
        document.getElementById('editTallaId').value = id;
        document.getElementById('editTallaNombre').value = data.nombre;
        document.getElementById('editTallaAjuste').value = data.ajuste;
        document.getElementById('editTallaPecho').value = data.pecho;
        document.getElementById('editTallaCintura').value = data.cintura;
        document.getElementById('editTallaCadera').value = data.cadera;
        document.getElementById('editTallaLargo').value = data.largo;
        mostrarModal('modalEditarTalla');
    }

    function editarProveedor(id, data) {
        document.getElementById('editProvId').value = id;
        document.getElementById('editProvNombre').value = data.nombre;
        document.getElementById('editProvContacto').value = data.contacto;
        document.getElementById('editProvTelefono').value = data.telefono;
        mostrarModal('modalEditarProveedor');
    }

    // Manejadores de formularios de edici√≥n
    window.addEventListener('load', function() {
        // Formulario de Editar Categor√≠a
        const formEditarCategoria = document.getElementById('formEditarCategoria');
        if (formEditarCategoria) {
            formEditarCategoria.onsubmit = async function(e) {
                e.preventDefault();
                try {
                    const id = document.getElementById('editCatId').value;
                    const nombre = document.getElementById('editCatNombre').value.trim();
                    
                    if (!nombre) {
                        alert('El nombre es requerido');
                        return;
                    }

                    const response = await fetch('/api/categorias/' + id, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ nombre })
                    });

                    const data = await response.json();
                    if (data.success) {
                        cerrarModal('modalEditarCategoria');
                        cargarCategorias();
                    } else {
                        throw new Error(data.message || 'Error al actualizar categor√≠a');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert(error.message || 'Error al procesar la solicitud');
                }
            };
        }

        // Formulario de Editar Talla
        const formEditarTalla = document.getElementById('formEditarTalla');
        if (formEditarTalla) {
            formEditarTalla.onsubmit = async function(e) {
                e.preventDefault();
                try {
                    const id = document.getElementById('editTallaId').value;
                    const data = {
                        nombre: document.getElementById('editTallaNombre').value.trim(),
                        ajuste: document.getElementById('editTallaAjuste').value,
                        pecho: document.getElementById('editTallaPecho').value || null,
                        cintura: document.getElementById('editTallaCintura').value || null,
                        cadera: document.getElementById('editTallaCadera').value || null,
                        largo: document.getElementById('editTallaLargo').value || null
                    };

                    if (!data.nombre || !data.ajuste) {
                        alert('El nombre y el ajuste son requeridos');
                        return;
                    }

                    const response = await fetch('/api/tallas/' + id, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });

                    const responseData = await response.json();
                    if (responseData.success) {
                        cerrarModal('modalEditarTalla');
                        cargarTallas();
                    } else {
                        throw new Error(responseData.message || 'Error al actualizar talla');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert(error.message || 'Error al procesar la solicitud');
                }
            };
        }

        // Formulario de Editar Proveedor
        const formEditarProveedor = document.getElementById('formEditarProveedor');
        if (formEditarProveedor) {
            formEditarProveedor.onsubmit = async function(e) {
                e.preventDefault();
                try {
                    const id = document.getElementById('editProvId').value;
                    const data = {
                        nombre: document.getElementById('editProvNombre').value.trim(),
                        contacto: document.getElementById('editProvContacto').value.trim(),
                        telefono: document.getElementById('editProvTelefono').value.trim()
                    };

                    if (!data.nombre) {
                        alert('El nombre es requerido');
                        return;
                    }

                    const response = await fetch('/api/proveedores/' + id, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });

                    const responseData = await response.json();
                    if (responseData.success) {
                        cerrarModal('modalEditarProveedor');
                        cargarProveedores();
                    } else {
                        throw new Error(responseData.message || 'Error al actualizar proveedor');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert(error.message || 'Error al procesar la solicitud');
                }
            };
        }
    });

    // Funci√≥n para recargar listas (debe implementarse en cliente.js o aqu√≠)
    function cargarLista(tipo) {
        // Esta funci√≥n deber√≠a estar implementada en cliente.js
        // Aqu√≠ solo la declaramos para evitar errores
        console.log('Recargando lista de: ' + tipo);
    }

    window.onload = function() {
        switchTab('dashboard'); // Dashboard como p√°gina principal
        // Inicializa el submen√∫ de Cat√°logos
        switchCatalogTab('categorias');
        
        // Los productos se cargan autom√°ticamente desde cliente.js
        cargarDashboardData(); // Cargar datos del dashboard
        
        // Inicializar listeners para botones de acci√≥n en las listas
        ['Categorias', 'Tallas', 'Proveedores'].forEach(function(tipo) {
            const lista = document.getElementById('catalogo' + tipo);
            if (lista) {
                lista.addEventListener('click', function(e) {
                    const target = e.target;
                    if (target.classList.contains('btn')) {
                        const item = target.closest('.item');
                        const id = item.dataset.id;
                        const nombre = item.querySelector('span').textContent;
                        
                        if (target.textContent === 'Editar') {
                            if (tipo === 'Categorias') {
                                editarCategoria(id, nombre);
                            } else if (tipo === 'Tallas') {
                                editarTalla(id, {
                                    nombre: nombre,
                                    ajuste: item.dataset.ajuste,
                                    pecho: item.dataset.pecho,
                                    cintura: item.dataset.cintura,
                                    cadera: item.dataset.cadera,
                                    largo: item.dataset.largo
                                });
                            } else {
                                editarProveedor(id, {
                                    nombre: nombre,
                                    contacto: item.dataset.contacto,
                                    telefono: item.dataset.telefono
                                });
                            }
                        } else if (target.textContent === 'Eliminar') {
                            mostrarConfirmacion(id, tipo.toLowerCase(), nombre);
                        }
                    }
                });
            }
        });
    };

    // Funci√≥n para cargar datos del dashboard
    async function cargarDashboardData() {
        try {
            const res = await fetch('/api/dashboard/indicadores');
            const data = await res.json();
            
            if (data.ventasMes !== undefined) {
                document.getElementById('ventasMes').textContent = '$' + parseFloat(data.ventasMes).toFixed(2);
                const cambio = data.ventasCambio || 0;
                const cambioEl = document.getElementById('ventasCambio');
                cambioEl.textContent = (cambio >= 0 ? '‚Üë' : '‚Üì') + ' ' + Math.abs(cambio).toFixed(1) + '%';
                cambioEl.className = cambio >= 0 ? 'dashboard-card-change positive' : 'dashboard-card-change negative';
            }
            
            if (data.rotacionInventario !== undefined) {
                document.getElementById('rotacionInv').textContent = parseFloat(data.rotacionInventario).toFixed(2);
            }
            
            if (data.margenGanancia !== undefined) {
                document.getElementById('margenGanancia').textContent = parseFloat(data.margenGanancia).toFixed(1) + '%';
            }
            
            if (data.stockBajo !== undefined) {
                document.getElementById('stockBajo').textContent = data.stockBajo;
            }

            // Cargar gr√°fico de ventas por temporada
            setTimeout(() => {
                if (typeof fetchVentasTemporada === 'function') fetchVentasTemporada('actual');
            }, 300);
            
            // Cargar gr√°fico de m√°rgenes por categor√≠a
            setTimeout(() => {
                if (typeof cargarMargenCategoria === 'function') cargarMargenCategoria();
            }, 300);
            
            // Cargar top 10 utilidad
            setTimeout(() => {
                if (typeof cargarTop10Utilidad === 'function') cargarTop10Utilidad();
            }, 300);

        } catch (error) {
            console.error('Error cargando dashboard:', error);
        }
    }

    // Funci√≥n para cargar gr√°fico de ventas
    function cargarGraficoVentas(datos) {
        const canvas = document.getElementById('ventasChart');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        
        // Implementaci√≥n simple de gr√°fico (mejorar con Chart.js si se desea)
        const width = canvas.width = canvas.offsetWidth;
        const height = canvas.height = 300;
        
        ctx.clearRect(0, 0, width, height);
        ctx.strokeStyle = '#2563eb';
        ctx.lineWidth = 2;
        ctx.beginPath();
        
        const max = Math.max(...datos.map(d => d.ingreso_total || 0));
        const stepX = width / datos.length;
        
        datos.forEach((d, i) => {
            const x = i * stepX;
            const y = height - (d.ingreso_total / max) * height * 0.8 - 20;
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        });
        
        ctx.stroke();
    }

    // Funci√≥n para cargar gr√°fico de m√°rgenes
    function cargarGraficoMargenes(datos) {
        const canvas = document.getElementById('margenChart');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        
        const width = canvas.width = canvas.offsetWidth;
        const height = canvas.height = 300;
        
        ctx.clearRect(0, 0, width, height);
        
        const max = Math.max(...datos.map(d => d.margen_promedio || 0));
        const barWidth = width / datos.length - 10;
        
        datos.forEach((d, i) => {
            const x = i * (barWidth + 10) + 5;
            const barHeight = (d.margen_promedio / max) * height * 0.8;
            const y = height - barHeight - 20;
            
            ctx.fillStyle = '#10b981';
            ctx.fillRect(x, y, barWidth, barHeight);
        });
    }

    // Funci√≥n para cargar tabla de utilidad
    function cargarTablaUtilidad(datos) {
        const tbody = document.getElementById('tbodyUtilidad');
        if (!tbody) return;
        
        const top10 = datos.slice(0, 10);
        tbody.innerHTML = top10.map(prod => `
            <tr style="border-bottom:1px solid var(--surface-alt);">
                <td style="padding:var(--spacing-md);">${prod.nombre || prod.marca || 'N/A'}</td>
                <td style="padding:var(--spacing-md);text-align:right;">$${parseFloat(prod.total_ventas || 0).toFixed(2)}</td>
                <td style="padding:var(--spacing-md);text-align:right;">$${parseFloat(prod.utilidad_total || 0).toFixed(2)}</td>
                <td style="padding:var(--spacing-md);text-align:right;">${parseFloat(prod.margen_ganancia || 0).toFixed(1)}%</td>
            </tr>
        `).join('');
    }

    // Funci√≥n para buscar productos
    document.getElementById('btnBuscarProd').onclick = async function() {
        const busqueda = document.getElementById('prodBuscar').value.trim();
        try {
            const response = await fetch(`/api/productos/buscar?q=${encodeURIComponent(busqueda)}`);
            const data = await response.json();
            
            const contenedor = document.getElementById('adminProductos');
            if (data.length === 0) {
                contenedor.innerHTML = '<div class="item">No se encontraron productos</div>';
                return;
            }

            contenedor.innerHTML = data.map(producto => `
                <div class="item" data-id="${producto.id}">
                    <div class="producto-info">
                        <strong>${producto.marca} - ${producto.nombre}</strong><br>
                        Categor√≠a: ${producto.categoria}<br>
                        Precio: $${producto.precio} | Stock: ${producto.inventario}
                    </div>
                    <div class="actions">
                        <button class="btn btn-small" onclick="editarProducto('${producto.id}')">Editar</button>
                        <button class="btn btn-small secondary" onclick="mostrarConfirmacion('${producto.id}', 'productos', '${producto.nombre}')">Eliminar</button>
                    </div>
                </div>
            `).join('');

        } catch (error) {
            console.error('Error al buscar productos:', error);
            document.getElementById('adminProductos').innerHTML = 
                '<div class="item">Error al buscar productos</div>';
        }
    };
    </script>
</head>
<body>
    <div class="app-layout">
        <!-- Sidebar de navegaci√≥n -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">MS</div>
                <div class="sidebar-title">Modasoft</div>
            </div>
            <nav class="sidebar-nav">
                <div class="sidebar-section">
                    <div class="sidebar-section-title">General</div>
                    <ul class="sidebar-menu">
                        <li class="sidebar-menu-item">
                            <a href="#" class="sidebar-menu-link active" onclick="switchTab('dashboard'); return false;">
                                <span class="sidebar-menu-icon">üìä</span>
                                <span>Dashboard</span>
                            </a>
                        </li>
                    </ul>
            </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Operaciones</div>
                    <ul class="sidebar-menu">
                        <li class="sidebar-menu-item">
                            <a href="#" class="sidebar-menu-link" onclick="switchTab('inventario'); return false;">
                                <span class="sidebar-menu-icon">üì¶</span>
                                <span>Inventario</span>
                            </a>
                        </li>
                        <li class="sidebar-menu-item">
                            <a href="#" class="sidebar-menu-link" onclick="switchTab('compras'); return false;">
                                <span class="sidebar-menu-icon">üõí</span>
                                <span>Compras</span>
                            </a>
                        </li>
                        <li class="sidebar-menu-item">
                            <a href="#" class="sidebar-menu-link" onclick="switchTab('ventas'); return false;">
                                <span class="sidebar-menu-icon">üíµ</span>
                                <span>Ventas</span>
                            </a>
                        </li>
                        <li class="sidebar-menu-item">
                            <a href="#" class="sidebar-menu-link" onclick="switchTab('clientes'); return false;">
                                <span class="sidebar-menu-icon">üë•</span>
                                <span>Clientes</span>
                            </a>
                        </li>
                    </ul>
        </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Configuraci√≥n</div>
                    <ul class="sidebar-menu">
                        <li class="sidebar-menu-item">
                            <a href="#" class="sidebar-menu-link" onclick="switchTab('catalogo'); return false;">
                                <span class="sidebar-menu-icon">üìã</span>
                                <span>Cat√°logos</span>
                            </a>
                        </li>
                        <li class="sidebar-menu-item">
                            <a href="#" class="sidebar-menu-link" onclick="switchTab('promociones'); return false;">
                                <span class="sidebar-menu-icon">üéÅ</span>
                                <span>Promociones</span>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Contabilidad</div>
                    <ul class="sidebar-menu">
                        <li class="sidebar-menu-item">
                            <a href="#" class="sidebar-menu-link" onclick="switchTab('contabilidad'); return false;">
                                <span class="sidebar-menu-icon">üí∞</span>
                                <span>Contabilidad</span>
                            </a>
                        </li>
                        <li class="sidebar-menu-item">
                            <a href="#" class="sidebar-menu-link" onclick="switchTab('cuentas_pagar'); return false;">
                                <span class="sidebar-menu-icon">üìù</span>
                                <span>Cuentas por Pagar</span>
                            </a>
                        </li>
                        <li class="sidebar-menu-item">
                            <a href="#" class="sidebar-menu-link" onclick="switchTab('caja'); return false;">
                                <span class="sidebar-menu-icon">üè¶</span>
                                <span>Control de Caja</span>
                            </a>
                        </li>
                        <li class="sidebar-menu-item">
                            <a href="#" class="sidebar-menu-link" onclick="switchTab('conciliacion'); return false;">
                                <span class="sidebar-menu-icon">üîÑ</span>
                                <span>Conciliaci√≥n Bancaria</span>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Reportes</div>
                    <ul class="sidebar-menu">
                        <li class="sidebar-menu-item">
                            <a href="#" class="sidebar-menu-link" onclick="switchTab('reporte-compras'); return false;">
                                <span class="sidebar-menu-icon">üõí</span>
                                <span>Compras</span>
                            </a>
                        </li>
                        <li class="sidebar-menu-item">
                            <a href="#" class="sidebar-menu-link" onclick="switchTab('reporte-ventas'); return false;">
                                <span class="sidebar-menu-icon">üí∞</span>
                                <span>Ventas</span>
                            </a>
                        </li>
                        <li class="sidebar-menu-item">
                            <a href="#" class="sidebar-menu-link" onclick="switchTab('reporte-clientes'); return false;">
                                <span class="sidebar-menu-icon">üë•</span>
                                <span>Clientes</span>
                            </a>
                        </li>
                        <li class="sidebar-menu-item">
                            <a href="#" class="sidebar-menu-link" onclick="switchTab('reporte-utilidad'); return false;">
                                <span class="sidebar-menu-icon">üíµ</span>
                                <span>Utilidad</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <!-- Contenido principal -->
        <div class="main-content">
            <!-- Header superior -->
            <header class="top-header">
                <div class="top-header-left">
                    <div class="search-box">
                        <span>üîç</span>
                        <input type="text" placeholder="Buscar en el sistema...">
                    </div>
                </div>
                <div class="top-header-right">
                    <div class="header-icon" title="Calendario">üìÖ</div>
                    <div class="header-icon" title="Notificaciones">
                        üîî
                        <span class="notification-badge">2</span>
                    </div>
                    <div class="user-avatar" id="userAvatar">A</div>
                    <div id="userPanel" style="display:flex;align-items:center;gap:8px;">
                        <span id="userName" class="badge">Usuario</span>
                        <span id="rolLabel" class="badge role-badge">ADMIN</span>
                        <button id="logoutBtn" class="btn secondary">Cerrar sesi√≥n</button>
            </div>
        </div>
            </header>

            <!-- Contenido scrollable -->
            <div class="content-wrapper">
        <!-- Modal de confirmaci√≥n para eliminar -->
        <div id="modalConfirmarEliminar" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.4);z-index:1000;align-items:center;justify-content:center;">
            <div style="background:#fff;padding:30px;border-radius:8px;max-width:400px;margin:auto;position:relative;">
                <h3>Confirmar Eliminaci√≥n</h3>
                <p id="mensajeConfirmacion">¬øEst√° seguro de que desea eliminar este elemento?</p>
                <input type="hidden" id="eliminarId">
                <input type="hidden" id="eliminarTipo">
                <div style="margin-top:20px;text-align:right;">
                    <button onclick="confirmarEliminacion()" class="btn primary">Eliminar</button>
                    <button onclick="cerrarModalConfirmar()" class="btn secondary">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal de edici√≥n de categor√≠a -->
        <div id="modalEditarCategoria" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.4);z-index:1000;align-items:center;justify-content:center;">
            <div style="background:#fff;padding:30px;border-radius:8px;max-width:400px;margin:auto;position:relative;">
                <h3>Editar Categor√≠a</h3>
                <form id="formEditarCategoria">
                    <input type="hidden" id="editCatId">
                    <label>Nombre:<input type="text" id="editCatNombre" class="input" required></label>
                    <div style="margin-top:20px;text-align:right;">
                        <button type="submit" class="btn primary">Guardar</button>
                        <button type="button" onclick="cerrarModal('modalEditarCategoria')" class="btn secondary">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal de edici√≥n de talla -->
        <div id="modalEditarTalla" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.4);z-index:1000;align-items:center;justify-content:center;">
            <div style="background:#fff;padding:30px;border-radius:8px;max-width:400px;margin:auto;position:relative;">
                <h3>Editar Talla</h3>
                <form id="formEditarTalla">
                    <input type="hidden" id="editTallaId">
                    <label>Nombre:<input type="text" id="editTallaNombre" class="input" required maxlength="10"></label><br>
                    <label>Ajuste:
                        <select id="editTallaAjuste" class="input" required>
                            <option value="">Ajuste</option>
                            <option value="Slim">Slim Fit</option>
                            <option value="Regular">Regular Fit</option>
                            <option value="Oversized">Oversized</option>
                        </select>
                    </label><br>
                    <label>Pecho (cm):<input type="number" id="editTallaPecho" class="input" min="0"></label><br>
                    <label>Cintura (cm):<input type="number" id="editTallaCintura" class="input" min="0"></label><br>
                    <label>Cadera (cm):<input type="number" id="editTallaCadera" class="input" min="0"></label><br>
                    <label>Largo (cm):<input type="number" id="editTallaLargo" class="input" min="0"></label><br>
                    <div style="margin-top:20px;text-align:right;">
                        <button type="submit" class="btn primary">Guardar</button>
                        <button type="button" onclick="cerrarModal('modalEditarTalla')" class="btn secondary">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal de edici√≥n de proveedor -->
        <div id="modalEditarProveedor" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.4);z-index:1000;align-items:center;justify-content:center;">
            <div style="background:#fff;padding:30px;border-radius:8px;max-width:400px;margin:auto;position:relative;">
                <h3>Editar Proveedor</h3>
                <form id="formEditarProveedor">
                    <input type="hidden" id="editProvId">
                    <label>Nombre:<input type="text" id="editProvNombre" class="input" required></label><br>
                    <label>Contacto:<input type="text" id="editProvContacto" class="input"></label><br>
                    <label>Tel√©fono:<input type="text" id="editProvTelefono" class="input"></label><br>
                    <div style="margin-top:20px;text-align:right;">
                        <button type="submit" class="btn primary">Guardar</button>
                        <button type="button" onclick="cerrarModal('modalEditarProveedor')" class="btn secondary">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal de edici√≥n de producto -->
        <div id="modalEditarProducto" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.4);z-index:1000;align-items:center;justify-content:center;overflow-y:auto;">
            <div style="background:#fff;padding:30px;border-radius:8px;max-width:600px;margin:auto;position:relative;">
                <h3>Editar Producto</h3>
                <form id="formEditarProducto">
                    <input type="hidden" id="editIdProducto">
                    <label>Marca:<input type="text" id="editMarca" class="input" required></label><br>
                    <label>Nombre:<input type="text" id="editNombre" class="input" required></label><br>
                    <label>Categor√≠a:
                        <select id="editCategoria" class="input" required></select>
                    </label><br>
                    <label>Proveedor:
                        <select id="editProveedor" class="input" required></select>
                    </label><br>
                    <label>Precio ($):<input type="number" id="editPrecio" class="input" step="0.01" required></label><br>
                    <label>Cantidad adicional (sumar al total):<input type="number" id="editInventario" class="input" min="0" value="0" placeholder="0"></label><br>
                    <div style="margin-top:15px;margin-bottom:15px;">
                        <fieldset style="border:1px solid #ccc; padding:15px;border-radius:4px;">
                            <legend style="font-weight:600;">Agregar cantidades por talla</legend>
                            <p style="font-size:0.9em;color:#666;margin-bottom:10px;">Ingresa las cantidades que deseas <strong>AGREGAR</strong> a cada talla (se sumar√°n a las existentes)</p>
                            <div id="editTallasDinamicas"></div>
                        </fieldset>
                    </div>
                    <div style="margin-top:10px;text-align:right;">
                        <button type="submit" class="btn primary">Guardar</button>
                        <button type="button" class="btn" id="btnCerrarModal">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- Modal Detalle de Venta (Admin) -->
        <div id="modalDetalleVenta" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.4);z-index:1000;align-items:center;justify-content:center;">
            <div style="background:#fff;padding:20px;border-radius:8px;max-width:700px;width:90vw;">
                <button onclick="document.getElementById('modalDetalleVenta').style.display='none'" style="float:right;">&times;</button>
                <h3 id="detalleVentaTitle">Detalle de Venta</h3>
                <div id="detalleVentaBody">Cargando...</div>
            </div>
        </div>
                <!-- DASHBOARD GERENCIAL (P√°gina Principal) -->
                <div id="dashboardPanel" class="panel tabContent" style="display:flex;flex-direction:column;">
                    <h2 style="margin-bottom:var(--spacing-xl);">Dashboard Gerencial</h2>
                    
                    <!-- Tarjetas de indicadores -->
                    <div class="dashboard-grid">
                        <div class="dashboard-card gradient-blue">
                            <div class="dashboard-card-icon">üí∞</div>
                            <div class="dashboard-card-title">Ventas del Mes</div>
                            <div class="dashboard-card-value" id="ventasMes">$0.00</div>
                            <div class="dashboard-card-change positive" id="ventasCambio">Cargando...</div>
            </div>
                        <div class="dashboard-card gradient-teal">
                            <div class="dashboard-card-icon">üì¶</div>
                            <div class="dashboard-card-title">Rotaci√≥n de Inventario</div>
                            <div class="dashboard-card-value" id="rotacionInv">0.0</div>
                            <div class="dashboard-card-change">Indicador mensual</div>
                        </div>
                        <div class="dashboard-card gradient-dark">
                            <div class="dashboard-card-icon">üìà</div>
                            <div class="dashboard-card-title">Margen de Ganancia</div>
                            <div class="dashboard-card-value" id="margenGanancia">0%</div>
                            <div class="dashboard-card-change">Promedio general</div>
                        </div>
                        <div class="dashboard-card" style="background:var(--surface);">
                            <div class="dashboard-card-icon" style="color:var(--warning);">‚ö†Ô∏è</div>
                            <div class="dashboard-card-title" style="color:var(--text-secondary);">Stock Bajo</div>
                            <div class="dashboard-card-value" style="color:var(--text-primary);" id="stockBajo">0</div>
                            <div class="dashboard-card-change" style="color:var(--text-muted);">Productos con bajo inventario</div>
                        </div>
            </div>

                    <!-- Gr√°ficos -->
                    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(500px, 1fr));gap:var(--spacing-lg);">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h4 class="chart-title">An√°lisis de Ventas por Temporada</h4>
                                <select id="selectTemporadaDashboard" class="input" style="width:auto;" onchange="if(typeof fetchVentasTemporada === 'function') fetchVentasTemporada(this.value)">
                                    <option value="actual">Mes Actual</option>
                                    <option value="anterior">Mes Anterior</option>
                                    <option value="trimestre">√öltimo Trimestre</option>
                                    <option value="anual">A√±o Actual</option>
                                </select>
                            </div>
                            <div class="chart-canvas" style="height:400px;">
                                <canvas id="temporadaChart" style="max-height:400px;"></canvas>
                            </div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header">
                                <h4 class="chart-title">Margen de Ganancia por Categor√≠a</h4>
                            </div>
                            <div class="chart-canvas" style="height:400px;">
                                <canvas id="margenChart" style="max-height:400px;"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Indicadores adicionales -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h4 class="chart-title">Utilidad por Producto (Top 10)</h4>
                        </div>
                        <div id="tablaUtilidad" style="overflow-x:auto;">
                            <table style="width:100%;border-collapse:collapse;">
                                <thead>
                                    <tr style="background:var(--surface-alt);border-bottom:2px solid var(--surface-alt);">
                                        <th style="padding:var(--spacing-md);text-align:left;">Producto</th>
                                        <th style="padding:var(--spacing-md);text-align:right;">Ventas</th>
                                        <th style="padding:var(--spacing-md);text-align:right;">Utilidad</th>
                                        <th style="padding:var(--spacing-md);text-align:right;">Margen %</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyUtilidad">
                                    <tr><td colspan="4" style="padding:var(--spacing-md);text-align:center;">Cargando datos...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            
            <!-- 1. GESTI√ìN DE INVENTARIO Y PRODUCTOS -->
            <div id="inventarioPanel" class="panel tabContent" style="display:none;">
                <h3>Gesti√≥n de Productos</h3>
                <div class="row header-row">
                                        <h4>Crear Producto</h4>
                                </div>
                                <form id="form-producto-admin">
                                    <div class="row form-row">
                                        <div class="col">
                                            <input id="prodMarca" placeholder="Marca" class="input" required>
                                        </div>
                                        <div class="col">
                                            <select id="prodCategoria" class="input" required>
                                                <option value="">Selecciona Categor√≠a</option>
                                                <!-- Opciones din√°micas -->
                                            </select>
                                        </div>
                                        <div class="col">
                                            <select id="prodProveedor" class="input" required>
                                                <option value="">Selecciona Proveedor</option>
                                                <!-- Opciones din√°micas -->
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row form-row">
                                        <div class="col">
                                            <input id="prodNombre" placeholder="Nombre del Producto" class="input" required>
                                        </div>
                                        <div class="col">
                                            <input id="prodPrecio" placeholder="Precio ($)" type="number" step="0.01" class="input" required>
                                        </div>
                                    </div>
                                    <div class="row form-row">
                                        <button id="btnCrearProd" class="btn primary" type="submit">Registrar Producto</button>
                                    </div>
                                </form>
                
                <div class="row header-row">
                    <h4>Listado de Productos</h4>
                </div>
                <div class="list-search">
                    <input id="prodBuscar" placeholder="Buscar productos por nombre o marca..." class="input" type="text">
                    </div>
                <div id="adminProductos" class="list">
                    <div class="item">Cargando lista de productos...</div>
                </div>
            </div>

            <!-- 2. CAT√ÅLOGOS: TALLAS, CATEGOR√çAS, PROVEEDORES -->
            <div id="catalogoPanel" class="panel tabContent" style="display:none;">
                <h2 style="color: #3b82f6;">Configuraci√≥n de Cat√°logos</h2>
                
                <!-- Submen√∫ dentro de Cat√°logos -->
                <nav class="catalog-subnav" aria-label="Submen√∫ Cat√°logos">
                    <button id="cat-tab-categorias" class="active" onclick="switchCatalogTab('categorias')">Categor√≠as</button>
                    <button id="cat-tab-tallas" onclick="switchCatalogTab('tallas')">Tallas</button>
                    <button id="cat-tab-proveedores" onclick="switchCatalogTab('proveedores')">Proveedores</button>
                </nav>

                <!-- Gesti√≥n de Categor√≠as (Ejemplo de CRUD simple) -->
                <div id="catalog-categorias" class="catalog-section">
                    <h3>Gesti√≥n de Categor√≠as</h3>
                    <form id="form-categoria" class="row form-row">
                        <div class="col">
                            <input id="catNombre" name="catNombre" placeholder="Nueva Categor√≠a (Ej: Camisetas)" class="input" required>
                        </div>
                        <div class="col" style="flex: 0 0 auto;">
                            <button id="btnCrearCat" class="btn primary" type="submit">Crear Categor√≠a</button>
                        </div>
                    </form>
                    <div class="list-search">
                        <input id="buscarCategoria" placeholder="Buscar categor√≠as..." class="input" type="text">
                    </div>
                    <div id="catalogoCategorias" class="list scroll-list">
                        <div class="item"><span>Cargando categor√≠as...</span><div class="actions"><button class="btn btn-small">Editar</button><button class="btn btn-small secondary">Eliminar</button></div></div>
                    </div>
                </div>

                <!-- Gesti√≥n de Tallas -->
                <div id="catalog-tallas" class="catalog-section" style="display:none;">
                    <h3>Gesti√≥n de Tallas (S, M, L, XL)</h3>
                    <form id="form-talla" class="row form-row">
                        <div class="col">
                            <input id="tallaNombre" name="tallaNombre" placeholder="Nombre de Talla (Ej: S, M, L, XL, 38)" class="input" required maxlength="10">
                        </div>
                        <div class="col">
                            <select id="tallaAjuste" name="tallaAjuste" class="input" required>
                                <option value="">Ajuste</option>
                                <option value="Slim">Slim Fit</option>
                                <option value="Regular">Regular Fit</option>
                                <option value="Oversized">Oversized</option>
                            </select>
                        </div>
                        <div class="col">
                            <input id="tallaPecho" name="tallaPecho" placeholder="Pecho (cm)" class="input" type="number" min="0">
                        </div>
                        <div class="col">
                            <input id="tallaCintura" name="tallaCintura" placeholder="Cintura (cm)" class="input" type="number" min="0">
                        </div>
                        <div class="col">
                            <input id="tallaCadera" name="tallaCadera" placeholder="Cadera (cm)" class="input" type="number" min="0">
                        </div>
                        <div class="col">
                            <input id="tallaLargo" name="tallaLargo" placeholder="Largo (cm)" class="input" type="number" min="0">
                        </div>
                        <div class="col" style="flex: 0 0 auto;">
                            <button id="btnCrearTalla" class="btn primary" type="submit">Crear Talla</button>
                        </div>
                    </form>
                    <div class="list-search">
                        <input id="buscarTalla" placeholder="Buscar tallas..." class="input" type="text">
                    </div>
                    <div id="catalogoTallas" class="list scroll-list">
                        <div class="item"><span>Cargando tallas...</span><div class="actions"><button class="btn btn-small">Editar</button><button class="btn btn-small secondary">Eliminar</button></div></div>
                    </div>
                </div>

                <!-- Gesti√≥n de Proveedores -->
                <div id="catalog-proveedores" class="catalog-section" style="display:none;">
                    <h3>Gesti√≥n de Proveedores</h3>
                    <form id="form-proveedor" class="row form-row">
                        <div class="col">
                            <input id="provNombre" name="provNombre" placeholder="Nombre del Proveedor" class="input" required>
                        </div>
                        <div class="col">
                            <input id="provContacto" name="provContacto" placeholder="Contacto" class="input">
                        </div>
                        <div class="col">
                            <input id="provTelefono" name="provTelefono" placeholder="Tel√©fono" class="input">
                        </div>
                        <div class="col" style="flex: 0 0 auto;">
                            <button id="btnCrearProv" class="btn primary" type="submit">Crear Proveedor</button>
                        </div>
                    </form>
                    <div class="list-search">
                        <input id="buscarProveedor" placeholder="Buscar proveedores..." class="input" type="text">
                    </div>
                    <div id="catalogoProveedores" class="list scroll-list">
                        <div class="item"><span>Cargando proveedores...</span><div class="actions"><button class="btn btn-small">Editar</button><button class="btn btn-small secondary">Eliminar</button></div></div>
                    </div>
                </div>
            </div>

            <!-- 3. TRANSACCIONES Y REPORTES -->
            <div id="transaccionesPanel" class="panel tabContent" style="display:none;">
                <h2 style="color: #3b82f6;">Reportes y Movimientos</h2>
                <!-- Reportes Gerenciales -->
                <h3>Indicadores Gerenciales</h3>
                <ul>
                  <li>Rotaci√≥n de Inventario</li>
                  <li>An√°lisis de Ventas por Temporada (seleccionable)</li>
                  <li>Control de Margen de Ganancias por Categor√≠a</li>
                  <li>Reporte de Utilidad por Producto</li>
                </ul>
                <!-- Placeholder para Ventas -->
                <h3>Listado de Ventas (Facturas)</h3>
                <div class="list-search">
                    <input id="buscarVenta" placeholder="Buscar ventas..." class="input" type="text">
                </div>
                <div id="reporteVentas" class="list">
                    <div class="item">Cargando ventas recientes...</div>
                </div>
                <!-- Placeholder para Movimientos de Caja -->
                <h3>Movimientos Contables y de Caja</h3>
                <div class="list-search">
                    <input id="buscarCaja" placeholder="Buscar movimientos de caja..." class="input" type="text">
                </div>
                <div id="reporteCaja" class="list">
                    <div class="item">Cargando movimientos contables...</div>
                </div>
                <!-- Placeholder para Clientes -->
                <h3>Listado de Clientes</h3>
                <div class="list-search">
                    <input id="buscarCliente" placeholder="Buscar clientes..." class="input" type="text">
                </div>
                <div id="reporteClientes" class="list">
                    <div class="item">Cargando lista de clientes...</div>
                </div>
                <!-- Placeholder para Compras -->
                <h3>Listado de √ìrdenes de Compra</h3>
                <div class="list-search">
                    <input id="buscarCompra" placeholder="Buscar √≥rdenes de compra..." class="input" type="text">
                </div>
                <div id="reporteCompras" class="list">
                    <div class="item">Cargando lista de compras...</div>
                </div>
                <!-- Placeholder para Devoluciones -->
                <h3>Gesti√≥n de Devoluciones (Clave requerida)</h3>
                <form id="form-devolucion">
                  <label>Clave de acceso:<input type="password" id="claveDevolucion" required></label>
                  <button type="submit" class="btn secondary">Acceder</button>
                </form>
                <div id="panelDevoluciones" style="display:none;">
                  <label>Buscar venta por fecha y hora:<input type="datetime-local" id="buscaVentaFecha"></label>
                  <button id="btnBuscarVenta" class="btn">Buscar Venta</button>
                  <div id="devolucionResultados"></div>
                </div>
            </div>
            
            <!-- PANEL DE COMPRAS -->
            <div id="comprasPanel" class="panel tabContent" style="display:none;">
                <h3>Gesti√≥n de Compras</h3>
                <div class="row header-row">
                    <h4>Registrar Nueva Compra</h4>
                </div>
                <form id="form-compra">
                    <div class="row form-row">
                        <div class="col">
                            <label>Proveedor</label>
                            <select id="compraProveedor" class="input" required>
                                <option value="">Selecciona Proveedor</option>
                            </select>
                        </div>
                        <div class="col">
                            <label>Fecha de Compra</label>
                            <input type="date" id="compraFecha" class="input" required>
                        </div>
                        <div class="col">
                            <label>Estado de Pago</label>
                            <select id="compraEstadoPago" class="input" required>
                                <option value="Pendiente">Pendiente</option>
                                <option value="Parcial">Parcial</option>
                                <option value="Pagada">Pagada</option>
                            </select>
                        </div>
                    </div>
                    <div class="row header-row">
                        <h4>Productos de la Compra</h4>
                    </div>
                    <div id="compraItems" class="list" style="max-height:300px;">
                        <div class="item">Agrega productos a la compra</div>
                    </div>
                    <div class="row form-row">
                        <div class="col">
                            <select id="compraProducto" class="input">
                                <option value="">Selecciona Producto</option>
                            </select>
                        </div>
                        <div class="col">
                            <select id="compraTalla" class="input">
                                <option value="">Selecciona Talla</option>
                            </select>
                        </div>
                        <div class="col">
                            <input type="number" id="compraCantidad" placeholder="Cantidad" class="input" min="1">
                        </div>
                        <div class="col">
                            <input type="number" id="compraCosto" placeholder="Costo Unitario" class="input" step="0.01" min="0">
                        </div>
                        <div class="col" style="flex:0 0 auto;">
                            <button type="button" id="btnAgregarItemCompra" class="btn secondary">Agregar</button>
                        </div>
                    </div>
                    <div class="row form-row">
                        <div class="col" style="text-align:right;">
                            <h4>Total: $<span id="compraTotal">0.00</span></h4>
                            <button type="submit" id="btnRegistrarCompra" class="btn primary">Registrar Compra</button>
                        </div>
                    </div>
                </form>
                <div class="row header-row">
                    <h4>Historial de Compras</h4>
                </div>
                <div class="list-search">
                    <input id="buscarCompraHistorial" placeholder="Buscar compras..." class="input" type="text">
                </div>
                <div id="listaCompras" class="list">
                    <div class="item">Cargando compras...</div>
                </div>
            </div>

            <!-- PANEL DE VENTAS -->
            <div id="ventasPanel" class="panel tabContent" style="display:none;">
                <h3>Registro y Consulta de Ventas</h3>
                <div class="list-search">
                    <input id="buscarVentaAdmin" placeholder="Buscar ventas por cliente, fecha..." class="input" type="text">
                </div>
                <div id="listaVentasAdmin" class="list">
                    <div class="item">Cargando ventas...</div>
                </div>
            </div>

            <!-- PANEL DE CLIENTES -->
            <div id="clientesPanel" class="panel tabContent" style="display:none;">
                <h3>Gesti√≥n de Clientes</h3>
                <div class="row header-row">
                    <h4>Registrar Nuevo Cliente</h4>
                </div>
                <form id="form-cliente">
                    <div class="row form-row">
                        <div class="col">
                            <label>Nombre Completo</label>
                            <input type="text" id="clienteNombre" class="input" required>
                        </div>
                        <div class="col">
                            <label>C√©dula</label>
                            <input type="text" id="clienteCedula" class="input">
                        </div>
                        <div class="col">
                            <label>Tel√©fono</label>
                            <input type="tel" id="clienteTelefono" class="input">
                        </div>
                        <div class="col">
                            <label>Email</label>
                            <input type="email" id="clienteEmail" class="input">
                        </div>
                    </div>
                    <div class="row form-row">
                        <button type="submit" class="btn primary">Registrar Cliente</button>
                    </div>
                </form>
                <div class="row header-row">
                    <h4>Listado de Clientes</h4>
                </div>
                <div class="list-search">
                    <input id="buscarClienteAdmin" placeholder="Buscar clientes..." class="input" type="text">
                </div>
                <div id="listaClientesAdmin" class="list">
                    <div class="item">Cargando clientes...</div>
                </div>
            </div>

            <!-- PANEL DE PROMOCIONES -->
            <div id="promocionesPanel" class="panel tabContent" style="display:none;">
                <h3>Gesti√≥n de Promociones</h3>
                <div class="row header-row">
                    <h4>Crear Nueva Promoci√≥n</h4>
                </div>
                <form id="form-promocion">
                    <div class="row form-row">
                        <div class="col">
                            <label>Nombre de la Promoci√≥n</label>
                            <input type="text" id="promoNombre" class="input" required>
                        </div>
                        <div class="col">
                            <label>Tipo de Promoci√≥n</label>
                            <select id="promoTipo" class="input" required>
                                <option value="DESCUENTO_PORCENTAJE">Descuento Porcentaje</option>
                                <option value="DESCUENTO_FIJO">Descuento Fijo</option>
                                <option value="COMPRA_X_LLEVA_Y">Compra X Lleva Y</option>
                            </select>
                        </div>
                        <div class="col">
                            <label>Valor (%) o Monto ($)</label>
                            <input type="number" id="promoValor" class="input" step="0.01" required>
                        </div>
                        <div id="promoParams" class="col" style="display:none;">
                            <label>Compra X (X):<input type="number" id="promoParamX" class="input" min="1"></label>
                            <label>Lleva Y (Y):<input type="number" id="promoParamY" class="input" min="0"></label>
                        </div>
                    </div>
                    <div class="row form-row">
                        <div class="col">
                            <label>Fecha Inicio</label>
                            <input type="date" id="promoFechaInicio" class="input" required>
                        </div>
                        <div class="col">
                            <label>Fecha Fin</label>
                            <input type="date" id="promoFechaFin" class="input" required>
                        </div>
                        <div class="col">
                            <label>Aplicar a</label>
                            <select id="promoAplicarA" class="input">
                                <option value="">Todas las categor√≠as</option>
                            </select>
                        </div>
                        <div class="col">
                            <label>Producto (opcional)</label>
                            <select id="promoProducto" class="input">
                                <option value="">Selecciona producto (opcional)</option>
                            </select>
                        </div>
                        <div class="col">
                            <label>Monto M√≠nimo de Compra</label>
                            <input type="number" id="promoMinimoCompra" class="input" step="0.01" value="0">
                        </div>
                    </div>
                    <div class="row form-row">
                        <div class="col" style="width:100%;">
                            <label>Descripci√≥n (opcional)</label>
                            <textarea id="promoDescripcion" class="input" rows="3" placeholder="Descripci√≥n breve de la promoci√≥n, condiciones, restricciones, etc."></textarea>
                        </div>
                    </div>
                    <div class="row form-row">
                        <div class="col">
                            <label><input type="checkbox" id="promoActiva" checked> Activa</label>
                        </div>
                        <div class="col" style="flex:0 0 auto;">
                            <button type="submit" id="promoSubmitBtn" class="btn primary">Crear Promoci√≥n</button>
                        </div>
                    </div>
                </form>
                <div class="row header-row">
                    <h4>Promociones Activas</h4>
                </div>
                <div class="list-search">
                    <input id="buscarPromocion" placeholder="Buscar promociones..." class="input" type="text">
                </div>
                <div id="listaPromociones" class="list">
                    <div class="item">Cargando promociones...</div>
                </div>
            </div>

            <!-- PANEL DE CONTABILIDAD -->
            <div id="contabilidadPanel" class="panel tabContent" style="display:none;">
                <h3>Registros Contables</h3>
                <div class="chart-container">
                    <div class="chart-header">
                        <h4 class="chart-title">Ingresos por Ventas</h4>
                        <select id="selectPeriodoIngresos" class="input" style="width:auto;">
                            <option value="mes">Mes Actual</option>
                            <option value="trimestre">Trimestre</option>
                            <option value="anual">A√±o Actual</option>
                        </select>
                    </div>
                    <div id="tablaIngresos" style="overflow-x:auto;">
                        <table style="width:100%;border-collapse:collapse;">
                            <thead>
                                <tr style="background:var(--surface-alt);">
                                    <th style="padding:var(--spacing-md);text-align:left;">Fecha</th>
                                    <th style="padding:var(--spacing-md);text-align:right;">Monto</th>
                                    <th style="padding:var(--spacing-md);text-align:left;">Tipo de Pago</th>
                                </tr>
                            </thead>
                            <tbody id="tbodyIngresos">
                                <tr><td colspan="3" style="padding:var(--spacing-md);text-align:center;">Cargando datos...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- PANEL DE CUENTAS POR PAGAR -->
            <div id="cuentas_pagarPanel" class="panel tabContent" style="display:none;">
                <h3>Gesti√≥n de Cuentas por Pagar</h3>
                <div class="list-search">
                    <input id="buscarCuentaPagar" placeholder="Buscar cuentas por pagar..." class="input" type="text">
                </div>
                <div id="listaCuentasPagar" class="list">
                    <div class="item">Cargando cuentas por pagar...</div>
                </div>
                
                <!-- Modal para registrar pago -->
                <div id="modalRegistrarPago" class="modal" style="display:none;">
                    <div class="modal-content">
                        <span class="close" onclick="cerrarModal('modalRegistrarPago')">&times;</span>
                        <h3>Registrar Pago</h3>
                        <form id="formRegistrarPago">
                            <input type="hidden" id="pagoIdCompra">
                            <div class="field">
                                <label>Estado de Pago</label>
                                <select id="pagoEstado" class="input" onchange="toggleMontoPago()">
                                    <option value="PARCIAL">Parcial</option>
                                    <option value="PAGADA">Completa</option>
                                </select>
                            </div>
                            <div class="field" id="fieldMontoPago">
                                <label>Monto a Pagar ($)</label>
                                <input type="number" id="pagoMonto" class="input" step="0.01" min="0.01" required oninput="calcularMontoRestante()">
                                <small style="display:block;margin-top:4px;">
                                    <strong>Monto pendiente total:</strong> $<span id="pagoMontoPendiente">0.00</span><br>
                                    <strong>Quedar√° debiendo:</strong> $<span id="pagoMontoRestante" style="color:var(--error);font-weight:bold;">0.00</span>
                                </small>
                            </div>
                            <div class="field">
                                <label>M√©todo de Pago</label>
                                <select id="pagoMetodo" class="input" required>
                                    <option value="EFECTIVO">Efectivo</option>
                                    <option value="TRANSFERENCIA">Transferencia</option>
                                    <option value="CHEQUE">Cheque</option>
                                    <option value="PAGO_MOVIL">Pago M√≥vil</option>
                                </select>
                            </div>
                            <div class="field">
                                <label>Referencia</label>
                                <input type="text" id="pagoReferencia" class="input" placeholder="N√∫mero de referencia, cheque, etc.">
                            </div>
                            <div class="field">
                                <label>Notas</label>
                                <textarea id="pagoNotas" class="input" rows="3" placeholder="Notas adicionales..."></textarea>
                            </div>
                            <button type="submit" class="btn primary">Registrar Pago</button>
                            <button type="button" class="btn secondary" onclick="cerrarModal('modalRegistrarPago')">Cancelar</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- PANEL DE CONTROL DE CAJA -->
            <div id="cajaPanel" class="panel tabContent" style="display:none;">
                <h3>Control de Movimientos de Caja</h3>
                <div class="list-search">
                    <input id="buscarMovimientoCaja" placeholder="Buscar movimientos..." class="input" type="text">
                </div>
                <div id="listaMovimientosCaja" class="list">
                    <div class="item">Cargando movimientos...</div>
                </div>
            </div>

            <!-- PANEL DE CONCILIACI√ìN BANCARIA -->
            <div id="conciliacionPanel" class="panel tabContent" style="display:none;">
                <h3>Conciliaci√≥n Bancaria</h3>
                <div class="row header-row">
                    <h4>Nueva Conciliaci√≥n</h4>
                </div>
                <form id="form-conciliacion">
                    <div class="row form-row">
                        <div class="col">
                            <label>Fecha de Conciliaci√≥n</label>
                            <input type="date" id="conciliacionFecha" class="input" required>
                        </div>
                        <div class="col">
                            <label>Saldo seg√∫n Libros</label>
                            <input type="number" id="conciliacionSaldoLibro" class="input" step="0.01" required>
                        </div>
                        <div class="col">
                            <label>Saldo seg√∫n Banco</label>
                            <input type="number" id="conciliacionSaldoBanco" class="input" step="0.01" required>
                        </div>
                    </div>
                    <div class="row form-row">
                        <button type="submit" class="btn primary">Registrar Conciliaci√≥n</button>
                    </div>
                </form>
                <div class="row header-row">
                    <h4>Historial de Conciliaciones</h4>
                </div>
                <div id="listaConciliaciones" class="list">
                    <div class="item">Cargando conciliaciones...</div>
                </div>
            </div>

            <!-- PANEL DE REPORTES -->
            <!-- PANEL: REPORTE DE COMPRAS -->
            <div id="reporte-comprasPanel" class="panel tabContent" style="display:none;">
                <h2 style="color: #ef4444; margin-bottom: 24px;">üõí Reporte de Compras</h2>
                <div class="chart-container">
                    <div id="reporteCompras" class="list">
                        <div class="item">Cargando reporte de compras...</div>
                    </div>
                </div>
            </div>

            <!-- PANEL: REPORTE DE VENTAS -->
            <div id="reporte-ventasPanel" class="panel tabContent" style="display:none;">
                <h2 style="color: #10b981; margin-bottom: 24px;">üí∞ Reporte de Ventas</h2>
                <div class="chart-container">
                    <div id="reporteVentas" class="list">
                        <div class="item">Cargando reporte de ventas...</div>
                    </div>
                </div>
            </div>

            <!-- PANEL: REPORTE DE CLIENTES -->
            <div id="reporte-clientesPanel" class="panel tabContent" style="display:none;">
                <h2 style="color: #3b82f6; margin-bottom: 24px;">üë• Reporte de Clientes</h2>
                <div class="chart-container">
                    <div id="reporteClientes" class="list">
                        <div class="item">Cargando reporte de clientes...</div>
                    </div>
                </div>
            </div>

            <!-- PANEL: REPORTE DE UTILIDAD -->
            <div id="reporte-utilidadPanel" class="panel tabContent" style="display:none;">
                <h2 style="color: #8b5cf6; margin-bottom: 24px;">üíµ Reporte de Utilidad por Producto</h2>
                <div class="chart-container">
                    <div id="tablaReporteUtilidad" class="list">
                        <div class="item">Cargando reporte de utilidad...</div>
                    </div>
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="cliente.js"></script>
    <script src="admin-funcionalidades.js"></script>
    <script src="reportes.js"></script>
</body>
</html>